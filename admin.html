<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Wedding RSVPs</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1);
        }

        .stat-card {
            text-align: center;
            padding: 24px;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .stat-label {
            color: #6b7280;
            font-weight: 500;
        }

        .table-row {
            transition: all 0.2s ease;
        }

        .table-row:hover {
            background-color: #f9fafb;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in-up {
            animation: fadeInUp 0.6s ease-out forwards;
        }

        .btn-export {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }

        .btn-export:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="card p-6 mb-8 fade-in-up">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900 mb-2">Wedding RSVP Dashboard</h1>
                    <p class="text-gray-600">Real-time guest management for Afzal & [Bride Name]'s Wedding</p>
                </div>
                <div class="flex space-x-4">
                    <button onclick="exportToCSV()" class="btn-export">
                        üìä Export CSV
                    </button>
                    <button onclick="refreshData()" class="btn-export">
                        üîÑ Refresh
                    </button>
                </div>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-6 mb-8">
            <div class="card stat-card fade-in-up">
                <div id="total-guests" class="stat-number text-purple-600">0</div>
                <div class="stat-label">Total Guests</div>
            </div>
            <div class="card stat-card fade-in-up">
                <div id="barat-guests" class="stat-number text-blue-600">0</div>
                <div class="stat-label">Barat Guests</div>
            </div>
            <div class="card stat-card fade-in-up">
                <div id="walima-guests" class="stat-number text-green-600">0</div>
                <div class="stat-label">Walima Guests</div>
            </div>
            <div class="card stat-card fade-in-up">
                <div id="media-messages" class="stat-number text-orange-600">0</div>
                <div class="stat-label">Media Messages</div>
            </div>
        </div>

        <!-- Language Distribution -->
        <div class="grid md:grid-cols-3 gap-6 mb-8">
            <div class="card p-6 text-center fade-in-up">
                <h3 class="text-lg font-semibold mb-4">Language Distribution</h3>
                <div class="space-y-2">
                    <div class="flex justify-between">
                        <span>English:</span>
                        <span id="lang-en" class="font-semibold">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span>‡§π‡§ø‡§Ç‡§¶‡•Ä:</span>
                        <span id="lang-hi" class="font-semibold">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span>ÿßÿ±ÿØŸà:</span>
                        <span id="lang-ur" class="font-semibold">0</span>
                    </div>
                </div>
            </div>

            <div class="card p-6 text-center fade-in-up">
                <h3 class="text-lg font-semibold mb-4">Event Capacity</h3>
                <div class="space-y-4">
                    <div>
                        <div class="flex justify-between text-sm mb-1">
                            <span>Barat</span>
                            <span><span id="barat-count">0</span>/200</span>
                        </div>
                        <div class="bg-gray-200 rounded-full h-2">
                            <div id="barat-progress" class="bg-blue-600 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                        </div>
                    </div>
                    <div>
                        <div class="flex justify-between text-sm mb-1">
                            <span>Walima</span>
                            <span><span id="walima-count">0</span>/250</span>
                        </div>
                        <div class="bg-gray-200 rounded-full h-2">
                            <div id="walima-progress" class="bg-green-600 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card p-6 text-center fade-in-up">
                <h3 class="text-lg font-semibold mb-4">Recent Activity</h3>
                <div id="recent-activity" class="space-y-2 text-sm">
                    <div class="text-gray-500">Loading...</div>
                </div>
            </div>
        </div>

        <!-- Guest List -->
        <div class="card p-6 fade-in-up">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Guest List</h2>
                <div class="flex space-x-4">
                    <select id="filterEvent" class="border border-gray-300 rounded-lg px-3 py-2 text-sm">
                        <option value="">All Events</option>
                        <option value="barat">Barat Only</option>
                        <option value="walima">Walima Only</option>
                        <option value="both">Both Events</option>
                    </select>
                    <select id="filterLanguage" class="border border-gray-300 rounded-lg px-3 py-2 text-sm">
                        <option value="">All Languages</option>
                        <option value="en">English</option>
                        <option value="hi">Hindi</option>
                        <option value="ur">Urdu</option>
                    </select>
                </div>
            </div>

            <div class="overflow-x-auto">
                <table class="w-full table-auto">
                    <thead>
                        <tr class="bg-gray-50 border-b">
                            <th class="px-4 py-3 text-left font-semibold text-gray-700">Name</th>
                            <th class="px-4 py-3 text-left font-semibold text-gray-700">Phone</th>
                            <th class="px-4 py-3 text-left font-semibold text-gray-700">Events</th>
                            <th class="px-4 py-3 text-left font-semibold text-gray-700">Language</th>
                            <th class="px-4 py-3 text-center font-semibold text-gray-700">Media</th>
                            <th class="px-4 py-3 text-left font-semibold text-gray-700">Submitted</th>
                            <th class="px-4 py-3 text-center font-semibold text-gray-700">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="guest-list">
                        <!-- Guest data will be populated here -->
                    </tbody>
                </table>
            </div>

            <div id="no-guests" class="text-center py-8 text-gray-500 hidden">
                No guests found matching the current filters.
            </div>
        </div>
    </div>

    <script>
        // Mock guest data (replace with Firebase data)
        let allGuests = [
            {
                id: 1,
                name: "Ahmed Khan",
                phone: "+91 9876543210",
                events: ["barat", "walima"],
                wishes: "May Allah bless your union with happiness and prosperity! Looking forward to celebrating with you both.",
                mediaType: "audio",
                timestamp: "2024-06-15T10:30:00Z",
                language: "en"
            },
            {
                id: 2,
                name: "Fatima Sheikh",
                phone: "+91 9876543211",
                events: ["walima"],
                wishes: "‡§ñ‡•Å‡§∂‡§ø‡§Ø‡•ã‡§Ç ‡§∏‡•á ‡§≠‡§∞‡§æ ‡§π‡•ã ‡§Ü‡§™‡§ï‡§æ ‡§®‡§Ø‡§æ ‡§ú‡•Ä‡§µ‡§®! ‡§Ü‡§™ ‡§¶‡•ã‡§®‡•ã‡§Ç ‡§ï‡•ã ‡§¢‡•á‡§∞ ‡§∏‡§æ‡§∞‡•Ä ‡§∂‡•Å‡§≠‡§ï‡§æ‡§Æ‡§®‡§æ‡§è‡§Ç‡•§",
                mediaType: "video",
                timestamp: "2024-06-15T11:15:00Z",
                language: "hi"
            },
            {
                id: 3,
                name: "Mohammad Ali",
                phone: "+91 9876543212",
                events: ["barat"],
                wishes: "ÿßŸÑŸÑ€Å ÿ¢Ÿæ ⁄©Ÿà ÿÆŸàÿ¥ ÿ±⁄©⁄æ€í ÿßŸàÿ± ÿ¢Ÿæ ⁄©€å ÿ≤ŸÜÿØ⁄Ø€å ŸÖ€å⁄∫ ÿ®ÿ±⁄©ÿ™ ÿØ€í€î",
                mediaType: null,
                timestamp: "2024-06-15T12:00:00Z",
                language: "ur"
            },
            {
                id: 4,
                name: "Aisha Rahman",
                phone: "+91 9876543213",
                events: ["barat", "walima"],
                wishes: "Congratulations on your special day! Wishing you both a lifetime of love and happiness.",
                mediaType: "audio",
                timestamp: "2024-06-15T14:20:00Z",
                language: "en"
            },
            {
                id: 5,
                name: "Zara Siddiqui",
                phone: "+91 9876543214",
                events: ["walima"],
                wishes: "‡§Ü‡§™‡§ï‡•Ä ‡§∂‡§æ‡§¶‡•Ä ‡§ï‡•Ä ‡§¨‡§π‡•Å‡§§ ‡§¨‡§π‡•Å‡§§ ‡§¨‡§ß‡§æ‡§à! ‡§≠‡§ó‡§µ‡§æ‡§® ‡§Ü‡§™ ‡§¶‡•ã‡§®‡•ã‡§Ç ‡§ï‡•ã ‡§π‡§Æ‡•á‡§∂‡§æ ‡§ñ‡•Å‡§∂ ‡§∞‡§ñ‡•á‡•§",
                mediaType: "video",
                timestamp: "2024-06-15T16:45:00Z",
                language: "hi"
            }
        ];

        let filteredGuests = [...allGuests];
        let stats = {};

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadGuestData();
            setupFilters();
            updateStats();
            renderGuestList();
            updateRecentActivity();
        });

        // Load guest data
        function loadGuestData() {
            // In real implementation, this would fetch from Firebase
            filteredGuests = [...allGuests];
        }

        // Setup filters
        function setupFilters() {
            const eventFilter = document.getElementById('filterEvent');
            const languageFilter = document.getElementById('filterLanguage');

            eventFilter.addEventListener('change', applyFilters);
            languageFilter.addEventListener('change', applyFilters);
        }

        // Apply filters
        function applyFilters() {
            const eventFilter = document.getElementById('filterEvent').value;
            const languageFilter = document.getElementById('filterLanguage').value;

            filteredGuests = allGuests.filter(guest => {
                let eventMatch = true;
                let languageMatch = true;

                if (eventFilter) {
                    if (eventFilter === 'both') {
                        eventMatch = guest.events.includes('barat') && guest.events.includes('walima');
                    } else {
                        eventMatch = guest.events.includes(eventFilter);
                    }
                }

                if (languageFilter) {
                    languageMatch = guest.language === languageFilter;
                }

                return eventMatch && languageMatch;
            });

            renderGuestList();
        }

        // Update statistics
        function updateStats() {
            stats = {
                total: allGuests.length,
                barat: allGuests.filter(g => g.events.includes('barat')).length,
                walima: allGuests.filter(g => g.events.includes('walima')).length,
                media: allGuests.filter(g => g.mediaType).length,
                byLanguage: {
                    en: allGuests.filter(g => g.language === 'en').length,
                    hi: allGuests.filter(g => g.language === 'hi').length,
                    ur: allGuests.filter(g => g.language === 'ur').length
                }
            };

            // Update UI with animation
            animateCounter('total-guests', stats.total);
            animateCounter('barat-guests', stats.barat);
            animateCounter('walima-guests', stats.walima);
            animateCounter('media-messages', stats.media);

            // Update language distribution
            document.getElementById('lang-en').textContent = stats.byLanguage.en;
            document.getElementById('lang-hi').textContent = stats.byLanguage.hi;
            document.getElementById('lang-ur').textContent = stats.byLanguage.ur;

            // Update progress bars
            updateProgressBar('barat', stats.barat, 200);
            updateProgressBar('walima', stats.walima, 250);
        }

        // Animate counter
        function animateCounter(elementId, targetValue) {
            const element = document.getElementById(elementId);
            const currentValue = parseInt(element.textContent) || 0;
            const increment = targetValue > currentValue ? 1 : -1;
            const duration = 1000;
            const steps = Math.abs(targetValue - currentValue);

            if (steps === 0) return;

            const stepDuration = duration / steps;
            let current = currentValue;

            const timer = setInterval(() => {
                current += increment;
                element.textContent = current;

                if (current === targetValue) {
                    clearInterval(timer);
                }
            }, stepDuration);
        }

        // Update progress bar
        function updateProgressBar(event, count, capacity) {
            const percentage = (count / capacity) * 100;
            document.getElementById(`${event}-count`).textContent = count;
            document.getElementById(`${event}-progress`).style.width = `${percentage}%`;
        }

        // Render guest list
        function renderGuestList() {
            const tbody = document.getElementById('guest-list');
            const noGuests = document.getElementById('no-guests');

            tbody.innerHTML = '';

            if (filteredGuests.length === 0) {
                noGuests.classList.remove('hidden');
                return;
            }

            noGuests.classList.add('hidden');

            filteredGuests.forEach((guest, index) => {
                const row = document.createElement('tr');
                row.className = 'table-row border-b';

                const eventsText = guest.events.map(e => 
                    e.charAt(0).toUpperCase() + e.slice(1)
                ).join(', ');

                const mediaIcon = guest.mediaType === 'audio' ? 'üé§' : 
                                 guest.mediaType === 'video' ? 'üìπ' : 'üìù';

                const languageFlag = guest.language === 'en' ? 'üá∫üá∏' :
                                   guest.language === 'hi' ? 'üáÆüá≥' : 'üáµüá∞';

                const timeAgo = getTimeAgo(new Date(guest.timestamp));

                row.innerHTML = `
                    <td class="px-4 py-3">
                        <div class="font-medium text-gray-900">${guest.name}</div>
                    </td>
                    <td class="px-4 py-3 text-gray-700">${guest.phone}</td>
                    <td class="px-4 py-3">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
                            ${eventsText}
                        </span>
                    </td>
                    <td class="px-4 py-3">
                        <span class="inline-flex items-center">
                            ${languageFlag} ${guest.language.toUpperCase()}
                        </span>
                    </td>
                    <td class="px-4 py-3 text-center">
                        <span class="text-xl" title="${guest.mediaType || 'Text only'}">${mediaIcon}</span>
                    </td>
                    <td class="px-4 py-3 text-sm text-gray-500">${timeAgo}</td>
                    <td class="px-4 py-3 text-center">
                        <button onclick="viewGuest(${guest.id})" class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                            View
                        </button>
                    </td>
                `;

                tbody.appendChild(row);

                // Animate row appearance
                setTimeout(() => {
                    row.style.opacity = '0';
                    row.style.transform = 'translateY(20px)';
                    row.style.transition = 'all 0.3s ease-out';

                    setTimeout(() => {
                        row.style.opacity = '1';
                        row.style.transform = 'translateY(0)';
                    }, 50);
                }, index * 50);
            });
        }

        // Get time ago string
        function getTimeAgo(date) {
            const now = new Date();
            const diffInSeconds = Math.floor((now - date) / 1000);

            if (diffInSeconds < 60) return 'Just now';
            if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)}m ago`;
            if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)}h ago`;
            return `${Math.floor(diffInSeconds / 86400)}d ago`;
        }

        // Update recent activity
        function updateRecentActivity() {
            const recentActivity = document.getElementById('recent-activity');
            const recent = allGuests
                .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
                .slice(0, 3);

            recentActivity.innerHTML = recent.map(guest => `
                <div class="flex justify-between items-center">
                    <span class="text-gray-700">${guest.name}</span>
                    <span class="text-xs text-gray-500">${getTimeAgo(new Date(guest.timestamp))}</span>
                </div>
            `).join('');
        }

        // View guest details
        function viewGuest(guestId) {
            const guest = allGuests.find(g => g.id === guestId);
            if (guest) {
                alert(`Guest Details:\n\nName: ${guest.name}\nPhone: ${guest.phone}\nEvents: ${guest.events.join(', ')}\nLanguage: ${guest.language}\nWishes: ${guest.wishes}\nMedia: ${guest.mediaType || 'None'}\nSubmitted: ${new Date(guest.timestamp).toLocaleString()}`);
            }
        }

        // Export to CSV
        function exportToCSV() {
            const headers = ['Name', 'Phone', 'Events', 'Wishes', 'Media Type', 'Language', 'Timestamp'];
            const csvContent = [
                headers.join(','),
                ...allGuests.map(guest => [
                    `"${guest.name}"`,
                    `"${guest.phone}"`,
                    `"${guest.events.join(', ')}"`,
                    `"${guest.wishes.replace(/"/g, '""')}"`,
                    `"${guest.mediaType || 'None'}"`,
                    `"${guest.language}"`,
                    `"${guest.timestamp}"`
                ].join(','))
            ].join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `wedding-rsvp-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        // Refresh data
        function refreshData() {
            // In real implementation, this would fetch fresh data from Firebase
            loadGuestData();
            updateStats();
            renderGuestList();
            updateRecentActivity();

            // Show refresh feedback
            const refreshBtn = document.querySelector('button[onclick="refreshData()"]');
            const originalText = refreshBtn.innerHTML;
            refreshBtn.innerHTML = '‚úÖ Refreshed';
            setTimeout(() => {
                refreshBtn.innerHTML = originalText;
            }, 2000);
        }

        // Auto-refresh every 30 seconds
        setInterval(refreshData, 30000);
    </script>
</body>
</html>